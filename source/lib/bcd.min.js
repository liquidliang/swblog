!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BCD=e():t.BCD=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t,e){try{return new Function("obj, config","var __s='', _slice=[].slice, BCD=this;\nvar print=function(){__s+=_slice.apply(arguments).join('')};\n__s+='"+t.replace(/[\n\r]/g," ").replace(/<%\s*-(.*?)%>/g,"'+\n\tBCD.escape($1)+\n\t'").replace(/<%\s*=(.*?)%>/g,"'+\n\t($1)+\n\t'").replace(/<%/g,"';\n").replace(/%>\s*/g,"\n__s+='")+"';\nreturn __s;"+(c?"\n//# sourceURL=t://template/"+e:"")).bind(f)}catch(t){return f.reportError(t,"template wrong!"),function(){}}}var i=n(1),o=n(2),a=n(3),s=n(4),c=n(5),u=n(6).ajaxCache,f={is:i,url:o,time:a,cache:n(7),ajaxCache:u,history:s,extendState:s.extendState,isDebug:c},l={},h={},d=f.getScrollY=function(){return window.pageYOffset||(document.documentElement||document.body.parentNode||document.body).scrollTop};f.setTitle=function(t){document.title=t},f.reportError=function(t,e){e&&console.error("--"+e+"--"),c&&console.error(t.stack)};var p={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},v=/[<'>"`]/,g=/[<'>"`]/g;f.escape=function(t){return t=null==t?"":""+t,v.test(t)?t.replace(g,function(t){return p[t]}):""+(t||"")},f.template=function(t,e){e=e||"undefined/";var n,i=l[e];return e in h?n=i[t]:(i=l[e]={},h[e]=-1),n||(e+=++h[e]||"",n=i[t]=r(t,e),n.viewName=e),n};var m=f.command={};f.addCommand=f.addEvent=function(t,e){t in m&&f.reportError(new Error('The command "'+t+'" already exists, rename it!',"addCommand")),m[t]=e},f.exeCommand=function(t){var e=$(this);return e.find("[data-on]").each(function(){var e,n=$(this),r={},i=n.attr("data-on");if(i)try{r=o.getParamObj(i),e=m[r.m],e&&(r.url=n.attr("data-url"),e(n,r,t),n.removeAttr("data-on"),n.attr("data-event",i))}catch(t){f.reportError(t,'exeCommand action "'+i)}}),e},$.fn.exeCommand=$.fn.bindEvent=f.exeCommand,$.fn.setView=$.fn.setView||function(t){var e=this,n=e[0];if(!n)return f.reportError(new Error("the dom "+(t&&t.name)+" is not exit in html"),"domError");var r=n.BCD_viewOption||{};return r.__isInit?$.extend(r,t):!function(){function c(){return(r.viewList||[]).filter(function(t,n){return t&&t.reset?(t[0]&&t[0].parentNode&&t[0].parentNode.nodeType===(Element.ELEMENT_NODE||1)||e.append(t),!t.getViewOption("delay")):void f.reportError(new Error("viewList index="+n+" is wrong value!"))}).forEach(function(t){t.reset()}),y=!0,e.exeCommand(m)}function l(){if(e.attr("data-page")){var t=f.getPage();if(t&&t[0]!==n)return}var i=e.css("display");switch(r.end&&r.end.call(e,v,r)){case"hide":"none"!=i&&e.hide().trigger("hide");break;case!1:break;default:"none"==i&&e.show().trigger("show")}}function h(t){e.attr("data-view",t),c(),l()}function d(t,n,o,a){var s,c,u,l,d=0;try{if(l=r.name||e.attr("data-view"),!n||0!==r.cache.indexOf("next")){if(s=i.s(r.template)?f.template(r.template,l):r.template,v=t,m=r.filter?r.filter.call(e,t,r,a):t,i.f(s)?(u=s(m,r.config||{}),e[_](u),l=s.viewName):l=l||"container",h(l),c=r.check||g&&function(t){return!(!t||0!==t.ret)},!c)return 0;if(!c.call(e,v,r))return 0}return r.cache.indexOf("local")>0?1:2}catch(t){d=-1,f.reportError(t,'view render "'+l+'" has wrong '+(r.url?"ajax:"+r.url:"data"))}finally{e.trigger("reset",{data:v,options:r,status:d})}}function p(t){try{if(t&&i.s(t))r.update&&!o.getParam("t",t)&&(t=o.setParam("t",a.getStamp(r.update||"s"),t)),r.url=t,g=u.call(e,{url:t,success:d,error:r.error,timeout:r.timeout,cacheFirst:w,xhrFields:{withCredentials:!!r.withCredentials}});else{if(t&&i.f(t))return p(t.call(e,y,r));if(!t||!i.f(t.then))return d(t,0,r,v);var n=t.then(function(t){return p(t)});n.catch&&n.catch(function(t){f.reportError(t,r.name+" view promise reject")})}}catch(t){f.reportError(t,r.name+" view fetch error")}}var v,g,m,w,_="html",y=!1;r=n.BCD_viewOption=$.extend({},t),r.__isInit=!0,r.cache=r.cache||"normal_local",r.__getData=function(){return v||r.data},r.__setData=function(t){var e=p(t||r.source);e&&i.f(g)&&i.o(t)&&g(t,e)},r.__reset=function(t){try{var n,i=r.start&&r.start.call(e,y,r,t);if("show"===i)return l(),e;r.template&&(w=s.getCode()==-1||0!==r.cache.indexOf("normal"),_=r.full||"html","html"!=_||w||i===!1||e.hide(),n=r.getData||function(){return r.data?r.data:r.url||v}),t=t||r.source||n,p(t)}catch(t){f.reportError(t,r.name+" reset")}return e}}(),e},$.fn.getViewOption=function(t){if(!this[0])return null;var e=this[0].BCD_viewOption=this[0].BCD_viewOption||{};return t?e[t]:e},$.fn.reset=$.fn.reset||function(t){var e=this.getViewOption(),n=e&&e.__reset;return n?n(t):this.setView().reset(t)},$.fn.getData=function(){var t=this.getViewOption().__getData;if(t)return t()},$.fn.setData=$.fn.setData||function(t){var e=this.getViewOption().__setData;return e?e(t):this.setView().setData(t),this},$.fn.addView=function(t){var e=this.getViewOption("viewList")||[];return e.push(t),this.setView({viewList:e})},$.fn.removeView=function(t){var e=this.getViewOption("viewList")||[];return this.setView({viewList:e.filter(function(e){return t[0]!==e[0]||(e.remove(),!1)})})},$.fn.getView=function(){return this.data("view")?this:$(this.parents("[data-view]")[0])},$.fn.showParentView=function(){this.parents("[data-view]").show()};var w;f.getPage=function(){return w||$("body")},$.fn.getPage=function(){return this.data("page")?this:$(this.parents("[data-page]")[0]||f.getPage())},f.getHash=function(t){return location.hash.split("/").slice(1)[t]},f.app=function(t){function e(t){w=t,document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),s.getCode()!=-1&&scrollTo(0,0),f.setTitle(t.getViewOption("title")||""),t.reset(),c()}function n(t){$(w).hide().trigger("hide"),w=null;var n=u=f.getHash(0)||"undefined",r=$('[data-page="'+n+'"]')[0];r?(e($(r)),u=NaN):a&&/^[^"<>]+$/.test(n)?(w=r=$('<div data-page="'+n+'"></div>'),a.call(r,n,function(t){u==n&&(t&&t.attr?e(t.attr("data-page",n)):t!==-1&&($("body").append(r),e(r)),u=NaN)})):i?f.replaceHash(i):e($("body"))}function r(){n(location.hash)}var i,o=$("[data-page]").hide(),a=null,c=function(){console.log("logPV")};o[0]&&(w=$(o[0]),i="#!/"+w.attr("data-page")),t&&(t.initHTML&&(document.body.innerHTML=t.initHTML),a=t.initPage,f.setTitle=t.setTitle||f.setTitle,i=t.defHash||i,f.reportError=t.reportError||f.reportError,c=t.logPV||c);var u=!1;f.replaceHash=function(t){f.extendState({scrollY:d()},t),s.replace(),f.getHash(0)!=u&&n(t)},s.bindPopState(r)},f.Events={_callFun:function(t){t in this._events&&this._events[t].apply(this,arguments)},_forFun:function(t,e){var n=e[0];if(i.s(n))t.apply(this,e);else{var r=/.*/;e=[].slice.call(e),i.r(n)?r=n:e.unshift(r);for(var o in this._events)r.test(o)&&(e[0]=o,t.apply(this,e))}return this},on:function(t,e){return this._events=this._events||{},this._events[t]=e,this},off:function(t){return this._events?this._forFun.call(this,function(e){delete this._events[t]},arguments):this},trigger:function(t){return this._events?this._forFun.call(this,this._callFun,arguments):this}},f.Model=function(t){var e=t;this.set=function(t,n){return 2===arguments.length?(e=e||{},e[t]=n):e=t,this},this.get=function(t){return t?e&&e[t]:e},$.extend(this,f.Events)},f.go=function(t,e){f.extendState({scrollY:d()}),s.go(t,e)};try{$(window).on("error",function(t){var e=t.error||t;f.reportError(e,["windowError",t.filename,t.lineno,t.colno].join(":"))});var _=d();$(window).on("scroll",function(t){var e=d();f.getPage().trigger("pageScroll",e,_),_=e})}catch(t){}t.exports=f},function(t,e){"use strict";function n(t){return Object.prototype.toString.call(t).slice(8,-1)}function r(t){return function(e){return n(e)==t}}var i={String:"s",Boolean:"b",Number:"n",Function:"f",Undefined:"u",Null:"nl",Array:"a",Date:"d",RegExp:"r"};for(var o in i)n[i[o]]=r(o);n.o=function(t){return"object"==typeof t},t.exports=n},function(t,e){"use strict";function n(t){var e=t.match(/([^#?]*)(\??[^#]*)(#?.*)/);return e?e.slice(1):[t]}function r(t,e,n){var r,i;return n=n.replace(new RegExp("([&?#])"+t+"=([^&#]*)(&?)"),function(n,o,a,s){return i=a,e===!1?n:(r=!0,void 0===e?s?o:"":o+t+"="+e+s)}),{value:i,hasKey:r,parament:n}}function i(t,e,i,o){o=o||1;var a=n(i||location.href),s=r(t,e,a[o]);return a[o]=s.parament,s.arr=a,s}function o(t){var e=i("t",void 0,t,1);return{time:e.value||"",name:e.arr.join("")}}function a(t){return h.href=t,h.href}function s(t){if(!t)return d;var e={},r=n(t);if(r[1]){r=r[1].substr(1).split(/[=&]/);for(var i=r.length/2,o=0;o<i;o++)e[r[2*o]]=r[2*o+1]}return e}function c(t,e,n){return i(t,!1,e,n).value}function u(t,e,n,r){r=r||1;var o=["&","?","#"],a=i(t,e,n,r),s=a.arr;return a.hasKey||(s[r]+=(1===s[r].length?"":o[s[r]?0:r])+t+"="+e),s.join("")}function f(t,e,n){return i(t,void 0,e,n).arr.join("")}var l=$('<div><a href=""/></a></div>')[0],h=l.firstChild,d=s(location.href);t.exports={abs:a,parser:n,process:r,separateTime:o,getParamObj:s,getParam:c,setParam:u,removeParam:f}},function(t,e){"use strict";function n(t){return t>9?t:"0"+t}function r(t,e){return(e||new Date)[a[t]]()}function i(t,e){return(e||s).replace(/%[yMdhmst]/g,function(e){var i=r(e[1],t);return n("%M"===e?1+i:i)})}function o(t){return i(new Date,s.substr(0,s.indexOf(t)+1||12))}var a={y:"getFullYear",M:"getMonth",d:"getDate",h:"getHours",m:"getMinutes",s:"getSeconds",t:"getTime"},s="%y%M%d%h%m%s";t.exports={get:r,getStamp:o,formatDate:i,methodMap:a}},function(t,e,n){"use strict";function r(){return c.length-1}function i(t,e){try{history.replaceState($.extend({},history.state,t,{historyVariable:d}),document.title,e||location.hash)}catch(t){}}function o(t){c.push(t);for(var e=0,n=c.length;e<n;e++)if(c[e].isBegin)return c.splice(0,e)}function a(){var t={href:location.href,title:document.title},e=r();e>0?c[e-1].href==location.href?(h=-1,c.unshift(c.pop())):c[e].href==location.href?(h=0,d.isGo?h=2:p&&(h=1),c[e]=t):c[0].href==location.href?(h=1,c.push(c.shift())):(h=2,o(t)):(h=3,c.push(t)),d.isGo=0}function s(t){c[r()].title=t||document.title}var c,u,f=n(1),l=n(2),h=3,d={list:[{isBegin:1,href:document.referrer}],isGo:0},p=0,v=location.hash;history.state&&history.state.historyVariable&&(d=history.state.historyVariable),c=d.list,u=c[r()].href,t.exports={extendState:i,updateTitle:s,getCode:function(){return h},get:function(){return c},getLastPage:function(){return u},getState:function(t){return t=f.u(t)?-1:t,c.slice(t)[0]},replace:function(){var t=r();u=c[t].href,c[t]={href:location.href,title:document.title},h=4},go:function(t,e){s(),u=location.href,e=e||{},e.href=l.abs(t),d.isGo=1,o(e),t.indexOf(location.pathname+location.search)===-1&&i(),location.href=t},bindPopState:function(t){function e(){a(),t()}if(f.f(t)){var n=navigator.userAgent||"",r=1;/\(i[^;]+;( U;)? CPU.+Mac OS X/.test(n)&&(r=0,setTimeout(function(){r=1},5e3)),e(),window[n.indexOf("Trident")>-1?"onhashchange":"onpopstate"]=function(){(r||v!=location.hash)&&(p=1,e(),v=location.hash,p=0)}}}}},function(t,e){"use strict";function n(){}t.exports=/Debug/.test(n)||!!window.global_isDebug},function(t,e,n){"use strict";function r(t){var e={dataType:"json",timeout:8e3};$.extend(e,t),$.ajax(e)}function i(t,e,n,i,c){function u(t,e){var n=v||{ct:p.time};return n.ct=p.time,1===e?s.setLocal(p.name,t,n):2===e&&s.setSession(p.name,t,n),e}function f(t){h.success=function(n){return u(n,e.call(g,n,m,h,t))},h.error=function(){1!==m&&(o.f(n)?n.call(g,t,m,h):e.call(g,t,m,h))},r(h)}var l=t,h=t;o.s(t)?(h={url:l},i&&(h.timeout=i)):(l=h.url,e=h.success,n=h.error,c=h.cacheFirst);var d,p=a.separateTime(l),v=s._get(p.name)||s._getSession(p.name),g=this,m=0;e=e||$.noop;var w;return v&&(d=v.v||{},d.from_BCD_cache=!0,w=p.time&&v.ct===p.time,(c||w)&&(e.call(g,d,m,h),m=1)),w||f(d),u}var o=n(1),a=n(2),s=n(7);t.exports={ajax:r,ajaxCache:i}},function(t,e,n){"use strict";function r(t,e){return e=e||{},e.t=g,e.v=t,e}function i(t,e,n){var o=r(e,n);try{localStorage.setItem(t,JSON.stringify(o))}catch(r){n&&n.isFail?(v[t]=o,localStorage.clear()):(f(0,g-p),n=n||{},n.isFail=1,i(t,e,n))}}function o(t,e,n){var o=r(e,n);try{sessionStorage.setItem(t,JSON.stringify(o))}catch(n){i("BCD_db_"+t,e)}}function a(t){var e;try{return e=localStorage.getItem(t),e?JSON.parse(e):v[t]}catch(t){return e}}function s(t){try{var e=sessionStorage.getItem(t);if(e)return JSON.parse(e)}catch(t){}return a("BCD_db_"+t)}function c(t,e){var n=a(t);return n&&!n.permanent&&n.t&&n.t<=e}function u(t,e){var n=g-e;return d.r(t)&&d.n(e)?function(e){return c(e,n)&&t.test(e)}:d.r(t)?function(e){return t.test(e)}:d.n(e)?function(t){return c(t,n)}:0}function f(t,e){try{if(d.s(t))delete v[t],localStorage.removeItem(t);else{var n=u(t,e)||function(t){var e=a(t);return e&&!e.permanent};for(var r in localStorage)n(r)&&(console.log("[cache] remove local key: ",r),localStorage.removeItem(r))}}catch(t){}}function l(t){try{if(d.s(t))delete v["BCD_db_"+t],sessionStorage.removeItem(t);else{var e=u(t);if(e)for(var n in sessionStorage)e(n)&&sessionStorage.removeItem(n)}}catch(t){f(/^BCD_db_/)}}function h(t,e){var n=a(t);return d.o(n)&&"v"in n&&"t"in n?n.v:n||e}var d=n(1),p=1,v={},g=parseInt(Date.now()/36e5);setTimeout(function(){f(/^BCD_db_/,1)},5e3),t.exports={setLocal:i,setSession:o,_get:a,getLocal:h,set:function(){i.apply(this,arguments),console.error("请把方法名改成setLocal，set将被删掉")},get:function(){h.apply(this,arguments),console.error("请把方法名改成getLocal，get将被删掉")},_getSession:s,getSession:function(t,e){var n=s(t);return n?n.v:e||null},removeLocal:f,removeSession:l}}])});